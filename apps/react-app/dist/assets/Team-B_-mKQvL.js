import{c as D,u as $,r as n,s as d,V as c,j as e,m as x,P as B,U as G}from"./index-DR7js-zR.js";import{U as J}from"./user-plus-DtBP570A.js";import{M as K}from"./mail-C2_1pY6-.js";import{X as Q}from"./x-iJGCqyZh.js";import{S as W}from"./shield-DebencLf.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=D("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=D("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ie=()=>{const{user:i}=$(),[T,f]=n.useState([]),[I,u]=n.useState({}),[v,h]=n.useState({}),[z,w]=n.useState(!0),[U,y]=n.useState(!1),[P,g]=n.useState(!1),[m,j]=n.useState(null),[N,k]=n.useState(""),[E,C]=n.useState(""),[p,_]=n.useState(""),[b,S]=n.useState("member");n.useEffect(()=>{i&&R()},[i]);const R=async()=>{try{w(!0);const{data:r,error:a}=await d.from("teams").select("*").or(`owner_id.eq.${i==null?void 0:i.id}`).order("created_at",{ascending:!1});if(a)throw a;f(r||[]);const s={},t={};for(const o of r||[]){const{data:l,error:q}=await d.from("team_members").select(`
            *,
            user_profiles (
              email
            )
          `).eq("team_id",o.id);if(q)throw q;s[o.id]=l||[];const{data:X,error:M}=await d.from("team_invites").select("*").eq("team_id",o.id).eq("status","pending");if(M)throw M;t[o.id]=X||[]}u(s),h(t)}catch(r){console.error("Error fetching teams:",r),c.error("Erro ao carregar equipes")}finally{w(!1)}},A=async r=>{if(r.preventDefault(),!!i)try{const{data:a,error:s}=await d.from("teams").insert([{name:N,description:E,owner_id:i.id}]).select().single();if(s)throw s;const{error:t}=await d.from("team_members").insert([{team_id:a.id,user_id:i.id,role:"owner"}]);if(t)throw t;f(o=>[a,...o]),k(""),C(""),y(!1),c.success("Equipe criada com sucesso!")}catch(a){console.error("Error creating team:",a),c.error("Erro ao criar equipe")}},F=async r=>{if(r.preventDefault(),!!m)try{const{error:a}=await d.from("team_invites").insert([{team_id:m,email:p,role:b,invited_by:i==null?void 0:i.id}]);if(a)throw a;h(s=>({...s,[m]:[...s[m]||[],{id:"",team_id:m,email:p,role:b,status:"pending",invited_by:i==null?void 0:i.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),expires_at:new Date(Date.now()+7*24*60*60*1e3).toISOString()}]})),_(""),S("member"),g(!1),c.success("Convite enviado com sucesso!")}catch(a){console.error("Error inviting member:",a),c.error("Erro ao enviar convite")}},H=async(r,a)=>{try{const{error:s}=await d.from("team_members").delete().eq("id",a);if(s)throw s;u(t=>({...t,[r]:t[r].filter(o=>o.id!==a)})),c.success("Membro removido com sucesso!")}catch(s){console.error("Error removing member:",s),c.error("Erro ao remover membro")}},L=async(r,a)=>{try{const{error:s}=await d.from("team_invites").delete().eq("id",a);if(s)throw s;h(t=>({...t,[r]:t[r].filter(o=>o.id!==a)})),c.success("Convite cancelado com sucesso!")}catch(s){console.error("Error canceling invite:",s),c.error("Erro ao cancelar convite")}},O=async(r,a,s)=>{try{const{error:t}=await d.from("team_members").update({role:s}).eq("id",a);if(t)throw t;u(o=>({...o,[r]:o[r].map(l=>l.id===a?{...l,role:s}:l)})),c.success("Função atualizada com sucesso!")}catch(t){console.error("Error updating member role:",t),c.error("Erro ao atualizar função")}},V=r=>{switch(r){case"owner":return e.jsx(Y,{className:"h-4 w-4 text-yellow-500"});case"admin":return e.jsx(W,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(G,{className:"h-4 w-4 text-gray-500"})}};return e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Equipes"}),e.jsxs(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>y(!0),className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Nova Equipe"]})]}),z?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(r=>e.jsx("div",{className:"animate-pulse bg-gray-200 dark:bg-gray-700 rounded-lg h-32"},r))}):e.jsx("div",{className:"space-y-6",children:T.map(r=>{var a,s;return e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.name}),r.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:r.description})]}),e.jsxs(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{j(r.id),g(!0)},className:"flex items-center px-3 py-1.5 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Convidar"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Membros"}),e.jsx("div",{className:"space-y-2",children:(a=I[r.id])==null?void 0:a.map(t=>{var o;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center",children:[V(t.role),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:(o=t.user_profiles)==null?void 0:o.email})]}),e.jsx("div",{className:"flex items-center space-x-2",children:t.role!=="owner"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.role,onChange:l=>O(r.id,t.id,l.target.value),className:"text-sm border-gray-300 dark:border-gray-600 rounded-md",disabled:t.user_id===(i==null?void 0:i.id),children:[e.jsx("option",{value:"member",children:"Membro"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx("button",{onClick:()=>H(r.id,t.id),className:"text-red-500 hover:text-red-700",disabled:t.user_id===(i==null?void 0:i.id),children:e.jsx(Z,{className:"h-4 w-4"})})]})})]},t.id)})})]}),((s=v[r.id])==null?void 0:s.length)>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Convites Pendentes"}),e.jsx("div",{className:"space-y-2",children:v[r.id].map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:t.email})]}),e.jsx("button",{onClick:()=>L(r.id,t.id),className:"text-red-500 hover:text-red-700",children:e.jsx(Q,{className:"h-4 w-4"})})]},t.id))})]})]})]},r.id)})}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:"Criar Nova Equipe"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nome"}),e.jsx("input",{type:"text",value:N,onChange:r=>k(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"Digite o nome da equipe",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descrição"}),e.jsx("textarea",{value:E,onChange:r=>C(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"Digite a descrição da equipe",rows:3})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700",children:"Criar"})]})]})]})}),P&&m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:"Convidar Membro"}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("input",{type:"email",value:p,onChange:r=>_(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"Digite o email do membro",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Função"}),e.jsxs("select",{value:b,onChange:r=>S(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"member",children:"Membro"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),j(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700",children:"Enviar Convite"})]})]})]})})]})};export{ie as default};
//# sourceMappingURL=Team-B_-mKQvL.js.map
