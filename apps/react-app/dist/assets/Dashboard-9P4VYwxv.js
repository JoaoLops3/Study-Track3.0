import{j as e,S as oe}from"./ui-BN-0vsY4.js";import{r as l,b as ne}from"./vendor-1oV-3_XS.js";import{u as ie,a as le,s as L,V}from"./index-Kc8VGIUG.js";import{c as Y}from"./clsx-B-dksMZM.js";import{t as de,c as ce,C as K}from"./card-B6FZYyf3.js";const G=({className:o="",count:d=1})=>e.jsx(e.Fragment,{children:Array(d).fill(0).map((s,g)=>e.jsx("div",{className:`animate-pulse bg-gray-200 dark:bg-gray-700 rounded ${o}`},g))});function B(...o){return de(Y(o))}const J=o=>typeof o=="boolean"?`${o}`:o===0?"0":o,X=Y,ge=(o,d)=>s=>{var g;if((d==null?void 0:d.variants)==null)return X(o,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:h,defaultVariants:u}=d,m=Object.keys(h).map(c=>{const v=s==null?void 0:s[c],y=u==null?void 0:u[c];if(v===null)return null;const p=J(v)||J(y);return h[c][p]}),b=s&&Object.entries(s).reduce((c,v)=>{let[y,p]=v;return p===void 0||(c[y]=p),c},{}),M=d==null||(g=d.compoundVariants)===null||g===void 0?void 0:g.reduce((c,v)=>{let{class:y,className:p,..._}=v;return Object.entries(_).every(I=>{let[P,k]=I;return Array.isArray(k)?k.includes({...u,...b}[P]):{...u,...b}[P]===k})?[...c,y,p]:c},[]);return X(o,m,M,s==null?void 0:s.class,s==null?void 0:s.className)},ue=ge("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),j=l.forwardRef(({className:o,variant:d,size:s,asChild:g=!1,...h},u)=>{const m=g?oe:"button";return e.jsx(m,{className:ce(ue({variant:d,size:s,className:o})),ref:u,...h})});j.displayName="Button";const ve=()=>{const{user:o,isLoading:d}=ie(),{settings:s}=le(),g=ne(),[h,u]=l.useState([]),[m,b]=l.useState([]),[M,c]=l.useState(!0),[v,y]=l.useState(!1),[p,_]=l.useState(!1),[I,P]=l.useState(""),[k,F]=l.useState(""),[W,A]=l.useState(""),[R,z]=l.useState(""),[q,Z]=l.useState("grid"),[w,ee]=l.useState(""),[N,re]=l.useState([]),[T,te]=l.useState(!1),D=l.useMemo(()=>{const r=new Set;return[...h,...m].forEach(t=>{var n;(n=t.tags)==null||n.forEach(i=>r.add(i))}),Array.from(r)},[h,m]),O=l.useMemo(()=>h.filter(r=>{var a;const t=r.title.toLowerCase().includes(w.toLowerCase())||((a=r.description)==null?void 0:a.toLowerCase().includes(w.toLowerCase())),n=N.length===0||N.some(x=>{var C;return(C=r.tags)==null?void 0:C.includes(x)}),i=!T||r.is_favorite;return t&&n&&i}),[h,w,N,T]),Q=l.useMemo(()=>m.filter(r=>{var a,x,C,$;const t=r.title.toLowerCase().includes(w.toLowerCase())||typeof r.content=="object"&&r.content!==null&&"content"in r.content&&Array.isArray(r.content.content)&&(($=(C=(x=(a=r.content.content[0])==null?void 0:a.content)==null?void 0:x[0])==null?void 0:C.text)==null?void 0:$.toLowerCase().includes(w.toLowerCase())),n=N.length===0||N.some(E=>{var S;return(S=r.tags)==null?void 0:S.includes(E)}),i=!T||r.is_favorite;return t&&n&&i}),[m,w,N,T]),U=async(r,t,n)=>{try{if(!o)return;const i=r==="board"?"boards":"pages",a=r==="board"?h:m,x=r==="board"?u:b;if(!a.find(f=>f.id===t))return;const{data:$,error:E}=await L.from(i).select("*").eq("id",t).eq("owner_id",o.id).single();if(E)throw console.error("Erro ao buscar item:",E),E;if(!$)throw new Error("Item não encontrado ou não autorizado");const S=n===void 0?!0:!n,{error:H}=await L.from(i).update({is_favorite:S}).eq("id",t);if(H)throw H;r==="board"?u(a.map(f=>f.id===t?{...f,is_favorite:S}:f)):b(a.map(f=>f.id===t?{...f,is_favorite:S}:f)),V.success("Favorito atualizado com sucesso!")}catch(i){console.error("Error toggling favorite:",i),V.error("Erro ao atualizar favorito")}};l.useEffect(()=>{let r=!0,t=0;const n=3,i=async()=>{if(!(!o||!r))try{c(!0);const[a,x]=await Promise.all([L.from("boards").select("*").or(`owner_id.eq.${o.id},is_public.eq.true`).order("created_at",{ascending:!1}).limit(6),L.from("pages").select("*").eq("owner_id",o.id).order("created_at",{ascending:!1}).limit(6)]);if(a.error)throw console.error("Error fetching boards:",a.error),a.error;if(x.error)throw console.error("Error fetching pages:",x.error),x.error;r&&(u(a.data||[]),b(x.data||[]))}catch(a){console.error("Error fetching user content:",a),t<n?(t++,console.log(`Tentativa ${t} de ${n}`),setTimeout(i,1e3*t)):V.error("Erro ao carregar conteúdo. Por favor, recarregue a página.")}finally{r&&c(!1)}};return o&&!d?i():d||c(!1),()=>{r=!1}},[o,d]);const ae=async r=>{if(r.preventDefault(),!!o)try{const t={title:I,owner_id:o.id,tags:k.split(",").filter(a=>a.trim()).map(a=>a.trim()),is_favorite:!1,created_at:new Date().toISOString()},{data:n,error:i}=await L.from("boards").insert([t]).select().single();if(i)throw i;u(a=>[n,...a]),P(""),F(""),y(!1),g(`/board/${n.id}`)}catch(t){console.error("Error creating board:",t),V.error("Erro ao criar board. Por favor, tente novamente.")}},se=async r=>{if(r.preventDefault(),!!o)try{const t={title:W,owner_id:o.id,tags:R.split(",").filter(a=>a.trim()).map(a=>a.trim()),is_favorite:!1,created_at:new Date().toISOString(),content:{type:"doc",content:[{type:"paragraph",content:[]}]}},{data:n,error:i}=await L.from("pages").insert([t]).select().single();if(i)throw i;b(a=>[n,...a]),A(""),z(""),_(!1),g(`/page/${n.id}`)}catch(t){console.error("Error creating page:",t),V.error("Erro ao criar página. Por favor, tente novamente.")}};return d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-primary-600 rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})}):o?e.jsx("div",{className:"min-h-screen dark:bg-gray-900 bg-white",children:e.jsx("div",{className:"ml-6",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 dark:text-white text-gray-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold dark:text-white text-gray-900",children:"Dashboard"}),e.jsx("div",{className:"flex items-center space-x-4"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 min-w-[300px]",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Pesquisar...",value:w,onChange:r=>ee(r.target.value),className:"w-full pl-4 pr-9 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400 bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-search",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]})})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>te(!T),className:"flex items-center space-x-2 px-3 py-2 rounded-lg border dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800 border-gray-300 hover:bg-gray-100",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-star w-5 h-5",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),e.jsx("span",{children:"Favoritos"})]}),e.jsx("button",{onClick:()=>Z(q==="grid"?"list":"grid"),className:"p-2 rounded-lg border dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800 border-gray-300 hover:bg-gray-100",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-list w-5 h-5",children:[e.jsx("line",{x1:"8",x2:"21",y1:"6",y2:"6"}),e.jsx("line",{x1:"8",x2:"21",y1:"12",y2:"12"}),e.jsx("line",{x1:"8",x2:"21",y1:"18",y2:"18"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"6",y2:"6"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"12",y2:"12"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"18",y2:"18"})]})})]})]}),D.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:D.map(r=>e.jsxs("button",{onClick:()=>re(t=>t.includes(r)?t.filter(n=>n!==r):[...t,r]),className:"flex items-center space-x-1 px-3 py-1 rounded-full text-sm dark:bg-gray-800 dark:text-gray-300 bg-gray-100 text-gray-700 border-gray-300",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-tag w-4 h-4",children:[e.jsx("path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"}),e.jsx("circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor"})]}),e.jsx("span",{children:r})]},r))}),e.jsxs("div",{className:"mb-12",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold dark:text-white text-gray-900",children:"Boards"}),e.jsxs(j,{onClick:()=>y(!0),className:"flex items-center space-x-2 border border-gray-300 dark:border-gray-600",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-plus w-5 h-5",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5v14"})]}),e.jsx("span",{children:"Novo Board"})]})]}),v&&e.jsxs("form",{onSubmit:ae,className:"mb-4 p-4 border rounded-lg bg-white border-gray-300 dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("input",{type:"text",placeholder:"Título do Board",value:I,onChange:r=>P(r.target.value),className:"w-full mb-2 p-2 border rounded bg-white border-gray-300 text-gray-900 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",required:!0}),e.jsx("input",{type:"text",placeholder:"Tags (separadas por vírgula)",value:k,onChange:r=>F(r.target.value),className:"w-full mb-2 p-2 border rounded bg-white border-gray-300 text-gray-900 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{onClick:()=>y(!1),variant:"outline",children:"Cancelar"}),e.jsx(j,{type:"submit",children:"Criar"})]})]}),M?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(r=>e.jsx(G,{className:"h-32"},r))}):O.length>0?e.jsx("div",{className:B(q==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-4"),children:O.map(r=>e.jsxs(K,{className:"relative group hover:shadow-lg transition-shadow dark:bg-gray-800 dark:border-gray-700 bg-white border-gray-200",children:[e.jsx("button",{onClick:()=>U("board",r.id,r.is_favorite),className:"absolute top-2 right-2 p-1 rounded-full dark:hover:bg-gray-700 hover:bg-gray-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:r.is_favorite?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:B("w-5 h-5",r.is_favorite?"text-yellow-400":"dark:text-gray-400 text-gray-500"),children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}),e.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>g(`/board/${r.id}`),children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 dark:text-white text-gray-900",children:r.title}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map(t=>e.jsx("span",{className:"px-2 py-1 rounded-full text-sm dark:bg-gray-700 dark:text-gray-300 bg-gray-100 text-gray-600",children:t},t))})]})]},r.id))}):e.jsx("div",{className:B("text-center py-8",(s==null?void 0:s.theme)==="dark"?"text-gray-400":"text-gray-500"),children:"Nenhum board encontrado"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold dark:text-white text-gray-900",children:"Páginas"}),e.jsxs(j,{onClick:()=>_(!0),className:"flex items-center space-x-2 border border-gray-300 dark:border-gray-600",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-plus w-5 h-5",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5v14"})]}),e.jsx("span",{children:"Nova Página"})]})]}),p&&e.jsxs("form",{onSubmit:se,className:"mb-4 p-4 border rounded-lg bg-white border-gray-300 dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("input",{type:"text",placeholder:"Título da Página",value:W,onChange:r=>A(r.target.value),className:"w-full mb-2 p-2 border rounded bg-white border-gray-300 text-gray-900 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",required:!0}),e.jsx("input",{type:"text",placeholder:"Tags (separadas por vírgula)",value:R,onChange:r=>z(r.target.value),className:"w-full mb-2 p-2 border rounded bg-white border-gray-300 text-gray-900 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{onClick:()=>_(!1),variant:"outline",className:"dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:"Cancelar"}),e.jsx(j,{type:"submit",className:"dark:bg-primary-600 dark:hover:bg-primary-700",children:"Criar"})]})]}),M?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(r=>e.jsx(G,{className:"h-32"},r))}):Q.length>0?e.jsx("div",{className:B(q==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-4"),children:Q.map(r=>e.jsxs(K,{className:"relative group hover:shadow-lg transition-shadow dark:bg-gray-800 dark:border-gray-700 bg-white border-gray-200",children:[e.jsx("button",{onClick:()=>U("page",r.id,r.is_favorite),className:"absolute top-2 right-2 p-1 rounded-full dark:hover:bg-gray-700 hover:bg-gray-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:r.is_favorite?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:B("w-5 h-5",r.is_favorite?"text-yellow-400":"dark:text-gray-400 text-gray-500"),children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}),e.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>g(`/page/${r.id}`),children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 dark:text-white text-gray-900",children:r.title}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map(t=>e.jsx("span",{className:"px-2 py-1 rounded-full text-sm dark:bg-gray-700 dark:text-gray-300 bg-gray-100 text-gray-600",children:t},t))})]})]},r.id))}):e.jsx("div",{className:B("text-center py-8",(s==null?void 0:s.theme)==="dark"?"text-gray-400":"text-gray-500"),children:"Nenhuma página encontrada"})]})]})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Bem-vindo ao Study Track"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Por favor, faça login para continuar."}),e.jsx("button",{onClick:()=>g("/login"),className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors",children:"Ir para Login"})]})};export{ve as default};
