{"version":3,"file":"GithubRepos-C79acLvy.js","sources":["../../src/pages/GithubRepos.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { Github } from 'lucide-react';\r\nimport { useSettings } from '../contexts/SettingsContext';\r\nimport { supabase } from '../lib/supabase';\r\nimport { toast } from 'react-hot-toast';\r\nimport { GithubConnectButton } from '../components/integrations/GithubConnectButton';\r\n\r\ninterface Repo {\r\n  id: number;\r\n  name: string;\r\n  description: string;\r\n  html_url: string;\r\n  stargazers_count: number;\r\n  language: string;\r\n}\r\n\r\nconst GithubRepos = () => {\r\n  const { settings, updateSettings } = useSettings();\r\n  const [repos, setRepos] = useState<Repo[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchRepos = async () => {\r\n      try {\r\n        if (!settings.integrations.github) {\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        // Obter a sessão atual\r\n        const { data: { session } } = await supabase.auth.getSession();\r\n        if (!session) {\r\n          toast.error('Sessão expirada. Por favor, faça login novamente.');\r\n          return;\r\n        }\r\n\r\n        // Buscar o token do GitHub diretamente da sessão\r\n        const githubToken = session.provider_token || session.user?.identities?.[0]?.identity_data?.access_token;\r\n        console.log('Token do GitHub (session):', githubToken);\r\n        if (!githubToken) {\r\n          toast.error('Token do GitHub não encontrado. Por favor, reconecte sua conta.');\r\n          return;\r\n        }\r\n\r\n        // Buscar os repositórios usando o token do GitHub\r\n        const response = await fetch('https://api.github.com/user/repos', {\r\n          headers: {\r\n            'Authorization': `token ${githubToken}`,\r\n            'Accept': 'application/vnd.github.v3+json'\r\n          }\r\n        });\r\n\r\n        if (!response.ok) {\r\n          if (response.status === 401) {\r\n            toast.error('Token do GitHub expirado. Por favor, reconecte sua conta.');\r\n            return;\r\n          }\r\n          throw new Error('Erro ao buscar repositórios');\r\n        }\r\n        \r\n        const data = await response.json();\r\n        setRepos(data);\r\n      } catch (error) {\r\n        console.error('Erro:', error);\r\n        toast.error('Erro ao carregar repositórios');\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchRepos();\r\n  }, [settings.integrations.github]);\r\n\r\n  // Efeito para garantir que settings.integrations.github seja true se o token estiver presente\r\n  useEffect(() => {\r\n    const checkGithubIntegration = async () => {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      const githubToken = session?.provider_token || session?.user?.identities?.find(i => i.provider === 'github')?.identity_data?.access_token;\r\n      if (githubToken && !settings.integrations.github) {\r\n        await updateSettings({\r\n          integrations: {\r\n            ...settings.integrations,\r\n            github: true\r\n          }\r\n        });\r\n      }\r\n    };\r\n    checkGithubIntegration();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n      <div className=\"flex items-center justify-between mb-8\">\r\n        <div className=\"flex items-center\">\r\n          <Github className=\"w-8 h-8 text-gray-900 dark:text-white mr-3\" />\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n            Meus Repositórios GitHub\r\n          </h1>\r\n        </div>\r\n        <GithubConnectButton variant=\"primary\" />\r\n      </div>\r\n\r\n      {!settings.integrations.github && !isLoading && (\r\n        <div className=\"text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow\">\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\r\n            Conecte sua conta do GitHub para ver seus repositórios.\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {isLoading ? (\r\n        <div className=\"flex items-center justify-center py-12\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600\"></div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {repos.map((repo) => (\r\n            <div\r\n              key={repo.id}\r\n              className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-6 hover:shadow-lg transition-shadow duration-200\"\r\n            >\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\r\n                {repo.name}\r\n              </h3>\r\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4 line-clamp-2\">\r\n                {repo.description || 'Sem descrição'}\r\n              </p>\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                  {repo.language || 'N/A'}\r\n                </span>\r\n                <span className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                  ⭐ {repo.stargazers_count}\r\n                </span>\r\n              </div>\r\n              <a\r\n                href={repo.html_url}\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n                className=\"mt-4 inline-block text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300\"\r\n              >\r\n                Ver no GitHub →\r\n              </a>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GithubRepos; "],"names":["GithubRepos","settings","updateSettings","useSettings","repos","setRepos","useState","isLoading","setIsLoading","useEffect","session","supabase","toast","githubToken","_d","_c","_b","_a","response","data","error","i","jsxs","jsx","Github","GithubConnectButton","repo"],"mappings":"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"}