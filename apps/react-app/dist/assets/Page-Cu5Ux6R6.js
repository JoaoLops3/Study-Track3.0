import{f as M,b as _,u as z,r as a,j as e,s as o}from"./index-DR7js-zR.js";import{P as V,M as F,T as R,R as A}from"./RichTextEditor-BwR8f_sX.js";import{G as N,L as k}from"./lock-BEAg1Wcr.js";const H=()=>{const{id:c}=M(),d=_(),{user:u}=z(),[r,n]=a.useState(null),[P,h]=a.useState(!0),[g,S]=a.useState(null),[E,p]=a.useState(!1),[x,f]=a.useState(""),[y,b]=a.useState(!1),[C,j]=a.useState(!1),[w,l]=a.useState(!1),[v,T]=a.useState(null);a.useEffect(()=>{(async()=>{if(!(!c||!u))try{h(!0);const{data:s,error:i}=await o.from("pages").select("*").eq("id",c).single();if(i)throw i;if(!s)throw new Error("Page not found");n(s),f(s.title)}catch(s){console.error("Error fetching page:",s),S(s.message)}finally{h(!1)}})()},[c,u]),a.useEffect(()=>(r&&(document.title=`${r.title} - Study Track`),()=>{document.title="Study Track"}),[r]);const m=async()=>{if(!(!r||!x.trim())){l(!0);try{const{data:t,error:s}=await o.from("pages").update({title:x.trim()}).eq("id",r.id).select().single();if(s)throw s;t&&n(t),p(!1)}catch(t){console.error("Error updating page title:",t)}finally{l(!1)}}},L=async t=>{if(r){l(!0);try{const{data:s,error:i}=await o.from("pages").update({content:t}).eq("id",r.id).select().single();if(i)throw i;s&&(n(s),T(new Date))}catch(s){console.error("Error updating page content:",s)}finally{l(!1)}}},q=async()=>{if(r)try{const t=!r.is_public,{data:s,error:i}=await o.from("pages").update({is_public:t}).eq("id",r.id).select().single();if(i)throw i;s&&n(s),b(!1)}catch(t){console.error("Error updating page visibility:",t)}},D=async()=>{if(r)try{const{error:t}=await o.from("pages").delete().eq("id",r.id);if(t)throw t;d("/")}catch(t){console.error("Error deleting page:",t)}};return P?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-t-4 border-primary-600 rounded-full animate-spin"})}):g?e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-12 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Erro"}),e.jsx("p",{className:"text-gray-700 mb-6",children:g}),e.jsx("button",{onClick:()=>d("/"),className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Voltar ao Dashboard"})]}):r?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex-1",children:E?e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"text",value:x,onChange:t=>f(t.target.value),className:"text-3xl font-bold border-b-2 border-primary-500 bg-transparent focus:outline-none mr-2 w-full",onBlur:m,onKeyDown:t=>t.key==="Enter"&&m(),autoFocus:!0}),e.jsx("button",{onClick:m,className:"p-1 text-primary-600 hover:text-primary-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}):e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white cursor-pointer hover:text-primary-600 dark:hover:text-primary-400 group flex items-center",onClick:()=>p(!0),children:[r.title,e.jsx(V,{className:"w-4 h-4 ml-2 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex items-center mr-3",children:r.is_public?e.jsxs("div",{className:"flex items-center text-gray-600 text-sm bg-gray-100 px-2 py-1 rounded",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"Público"]}):e.jsxs("div",{className:"flex items-center text-gray-600 text-sm bg-gray-100 px-2 py-1 rounded",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"Privado"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>b(!y),className:"p-2 text-gray-700 hover:bg-gray-100 rounded-full",children:e.jsx(F,{className:"w-5 h-5"})}),y&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:q,className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:r.is_public?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Tornar privado"]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Tornar público"]})}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Excluir página"]})]})})]})]})]}),e.jsxs("div",{className:"mb-2 text-xs text-gray-500 flex justify-between",children:[e.jsxs("span",{children:["Última edição em ",new Date(r.created_at).toLocaleString()]}),w&&e.jsx("span",{children:"Salvando..."}),v&&!w&&e.jsxs("span",{children:["Salvo às ",v.toLocaleTimeString()]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:e.jsx("div",{className:"border dark:border-gray-700 rounded-md overflow-hidden",children:e.jsx(A,{initialContent:r.content,onChange:L,placeholder:"Comece a escrever..."})})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6",onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Excluir Página"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:['Tem certeza que deseja excluir "',r.title,'"? Esta ação não pode ser desfeita.']}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{className:"px-4 py-2 text-gray-600 hover:text-gray-800",onClick:()=>j(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:D,children:"Excluir"})]})]})})]}):e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-12 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Página não encontrada"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"A página que você está procurando não existe ou você não tem acesso a ela."}),e.jsx("button",{onClick:()=>d("/"),className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Voltar ao Dashboard"})]})};export{H as default};
//# sourceMappingURL=Page-Cu5Ux6R6.js.map
