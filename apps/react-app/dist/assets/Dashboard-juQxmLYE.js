import{j as e,r as l,u as ne,a as ie,b as le,s as _,V as R}from"./index-DR7js-zR.js";import{t as de,c as Y,a as ce,C as K}from"./card-D_xYbOXt.js";const Z=({className:t="",count:s=1})=>e.jsx(e.Fragment,{children:Array(s).fill(0).map((a,n)=>e.jsx("div",{className:`animate-pulse bg-gray-200 dark:bg-gray-700 rounded ${t}`},n))});function y(...t){return de(Y(t))}function G(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function ge(...t){return s=>{let a=!1;const n=t.map(o=>{const d=G(o,s);return!a&&typeof d=="function"&&(a=!0),d});if(a)return()=>{for(let o=0;o<n.length;o++){const d=n[o];typeof d=="function"?d():G(t[o],null)}}}}function ue(t){const s=xe(t),a=l.forwardRef((n,o)=>{const{children:d,...x}=n,m=l.Children.toArray(d),w=m.find(fe);if(w){const g=w.props.children,p=m.map(f=>f===w?l.Children.count(g)>1?l.Children.only(null):l.isValidElement(g)?g.props.children:null:f);return e.jsx(s,{...x,ref:o,children:l.isValidElement(g)?l.cloneElement(g,void 0,p):null})}return e.jsx(s,{...x,ref:o,children:d})});return a.displayName=`${t}.Slot`,a}var he=ue("Slot");function xe(t){const s=l.forwardRef((a,n)=>{const{children:o,...d}=a;if(l.isValidElement(o)){const x=pe(o),m=ye(d,o.props);return o.type!==l.Fragment&&(m.ref=n?ge(n,x):x),l.cloneElement(o,m)}return l.Children.count(o)>1?l.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var me=Symbol("radix.slottable");function fe(t){return l.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===me}function ye(t,s){const a={...s};for(const n in s){const o=t[n],d=s[n];/^on[A-Z]/.test(n)?o&&d?a[n]=(...m)=>{d(...m),o(...m)}:o&&(a[n]=o):n==="style"?a[n]={...o,...d}:n==="className"&&(a[n]=[o,d].filter(Boolean).join(" "))}return{...t,...a}}function pe(t){var n,o;let s=(n=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:n.get,a=s&&"isReactWarning"in s&&s.isReactWarning;return a?t.ref:(s=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,a=s&&"isReactWarning"in s&&s.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}const J=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,X=Y,ve=(t,s)=>a=>{var n;if((s==null?void 0:s.variants)==null)return X(t,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:o,defaultVariants:d}=s,x=Object.keys(o).map(g=>{const p=a==null?void 0:a[g],f=d==null?void 0:d[g];if(p===null)return null;const j=J(p)||J(f);return o[g][j]}),m=a&&Object.entries(a).reduce((g,p)=>{let[f,j]=p;return j===void 0||(g[f]=j),g},{}),w=s==null||(n=s.compoundVariants)===null||n===void 0?void 0:n.reduce((g,p)=>{let{class:f,className:j,...B}=p;return Object.entries(B).every(I=>{let[P,C]=I;return Array.isArray(C)?C.includes({...d,...m}[P]):{...d,...m}[P]===C})?[...g,f,j]:g},[]);return X(t,x,w,a==null?void 0:a.class,a==null?void 0:a.className)},be=ve("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),N=l.forwardRef(({className:t,variant:s,size:a,asChild:n=!1,...o},d)=>{const x=n?he:"button";return e.jsx(x,{className:ce(be({variant:s,size:a,className:t})),ref:d,...o})});N.displayName="Button";const ke=()=>{const{user:t,isLoading:s}=ne(),{settings:a}=ie(),n=le(),[o,d]=l.useState([]),[x,m]=l.useState([]),[w,g]=l.useState(!0),[p,f]=l.useState(!1),[j,B]=l.useState(!1),[I,P]=l.useState(""),[C,$]=l.useState(""),[F,M]=l.useState(""),[O,q]=l.useState(""),[A,ee]=l.useState("grid"),[k,re]=l.useState(""),[S,te]=l.useState([]),[T,ae]=l.useState(!1),D=l.useMemo(()=>{const r=new Set;return[...o,...x].forEach(i=>{var u;(u=i.tags)==null||u.forEach(h=>r.add(h))}),Array.from(r)},[o,x]),z=l.useMemo(()=>o.filter(r=>{var c;const i=r.title.toLowerCase().includes(k.toLowerCase())||((c=r.description)==null?void 0:c.toLowerCase().includes(k.toLowerCase())),u=S.length===0||S.some(v=>{var L;return(L=r.tags)==null?void 0:L.includes(v)}),h=!T||r.is_favorite;return i&&u&&h}),[o,k,S,T]),H=l.useMemo(()=>x.filter(r=>{var c,v,L,W;const i=r.title.toLowerCase().includes(k.toLowerCase())||typeof r.content=="object"&&r.content!==null&&"content"in r.content&&Array.isArray(r.content.content)&&((W=(L=(v=(c=r.content.content[0])==null?void 0:c.content)==null?void 0:v[0])==null?void 0:L.text)==null?void 0:W.toLowerCase().includes(k.toLowerCase())),u=S.length===0||S.some(V=>{var E;return(E=r.tags)==null?void 0:E.includes(V)}),h=!T||r.is_favorite;return i&&u&&h}),[x,k,S,T]),Q=async(r,i,u)=>{try{if(!t)return;const h=r==="board"?"boards":"pages",c=r==="board"?o:x,v=r==="board"?d:m;if(!c.find(b=>b.id===i))return;const{data:W,error:V}=await _.from(h).select("*").eq("id",i).eq("owner_id",t.id).single();if(V)throw console.error("Erro ao buscar item:",V),V;if(!W)throw new Error("Item não encontrado ou não autorizado");const E=u===void 0?!0:!u,{error:U}=await _.from(h).update({is_favorite:E}).eq("id",i);if(U)throw U;r==="board"?d(c.map(b=>b.id===i?{...b,is_favorite:E}:b)):m(c.map(b=>b.id===i?{...b,is_favorite:E}:b)),R.success("Favorito atualizado com sucesso!")}catch(h){console.error("Error toggling favorite:",h),R.error("Erro ao atualizar favorito")}};l.useEffect(()=>{let r=!0,i=0;const u=3,h=async()=>{if(!(!t||!r))try{g(!0);const[c,v]=await Promise.all([_.from("boards").select("*").or(`owner_id.eq.${t.id},is_public.eq.true`).order("created_at",{ascending:!1}).limit(6),_.from("pages").select("*").eq("owner_id",t.id).order("created_at",{ascending:!1}).limit(6)]);if(c.error)throw console.error("Error fetching boards:",c.error),c.error;if(v.error)throw console.error("Error fetching pages:",v.error),v.error;r&&(d(c.data||[]),m(v.data||[]))}catch(c){console.error("Error fetching user content:",c),i<u?(i++,console.log(`Tentativa ${i} de ${u}`),setTimeout(h,1e3*i)):R.error("Erro ao carregar conteúdo. Por favor, recarregue a página.")}finally{r&&g(!1)}};return t&&!s?h():s||g(!1),()=>{r=!1}},[t,s]);const se=async r=>{if(r.preventDefault(),!!t)try{const i={title:I,owner_id:t.id,tags:C.split(",").filter(c=>c.trim()).map(c=>c.trim()),is_favorite:!1,created_at:new Date().toISOString()},{data:u,error:h}=await _.from("boards").insert([i]).select().single();if(h)throw h;d(c=>[u,...c]),P(""),$(""),f(!1),n(`/board/${u.id}`)}catch(i){console.error("Error creating board:",i),R.error("Erro ao criar board. Por favor, tente novamente.")}},oe=async r=>{if(r.preventDefault(),!!t)try{const i={title:F,owner_id:t.id,tags:O.split(",").filter(c=>c.trim()).map(c=>c.trim()),is_favorite:!1,created_at:new Date().toISOString(),content:{type:"doc",content:[{type:"paragraph",content:[]}]}},{data:u,error:h}=await _.from("pages").insert([i]).select().single();if(h)throw h;m(c=>[u,...c]),M(""),q(""),B(!1),n(`/page/${u.id}`)}catch(i){console.error("Error creating page:",i),R.error("Erro ao criar página. Por favor, tente novamente.")}};return s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-primary-600 rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})}):t?e.jsx("div",{className:"min-h-screen dark:bg-gray-900 bg-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 dark:text-white text-gray-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold dark:text-white text-gray-900",children:"Dashboard"}),e.jsx("div",{className:"flex items-center space-x-4"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 min-w-[300px]",children:e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-search absolute left-3 top-1/2 transform -translate-y-1/2 dark:text-gray-400 text-gray-500",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]}),e.jsx("input",{type:"text",placeholder:"Pesquisar...",value:k,onChange:r=>re(r.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400 bg-white border-gray-300 text-gray-900 placeholder-gray-500"})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>ae(!T),className:"flex items-center space-x-2 px-3 py-2 rounded-lg border dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800 border-gray-300 hover:bg-gray-100",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-star w-5 h-5",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),e.jsx("span",{children:"Favoritos"})]}),e.jsx("button",{onClick:()=>ee(A==="grid"?"list":"grid"),className:"p-2 rounded-lg border dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800 border-gray-300 hover:bg-gray-100",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-list w-5 h-5",children:[e.jsx("line",{x1:"8",x2:"21",y1:"6",y2:"6"}),e.jsx("line",{x1:"8",x2:"21",y1:"12",y2:"12"}),e.jsx("line",{x1:"8",x2:"21",y1:"18",y2:"18"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"6",y2:"6"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"12",y2:"12"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"18",y2:"18"})]})})]})]}),D.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:D.map(r=>e.jsxs("button",{onClick:()=>te(i=>i.includes(r)?i.filter(u=>u!==r):[...i,r]),className:"flex items-center space-x-1 px-3 py-1 rounded-full text-sm dark:bg-gray-800 dark:text-gray-300 bg-gray-100 text-gray-700 border-gray-300",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-tag w-4 h-4",children:[e.jsx("path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"}),e.jsx("circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor"})]}),e.jsx("span",{children:r})]},r))}),e.jsxs("div",{className:"mb-12",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold dark:text-white text-gray-900",children:"Boards"}),e.jsxs(N,{onClick:()=>f(!0),className:"flex items-center space-x-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-plus w-5 h-5",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5v14"})]}),e.jsx("span",{children:"Novo Board"})]})]}),p&&e.jsxs("form",{onSubmit:se,className:y("mb-4 p-4 border rounded-lg",(a==null?void 0:a.theme)==="dark"?"bg-gray-800 border-gray-700":"bg-white border-gray-300"),children:[e.jsx("input",{type:"text",placeholder:"Título do Board",value:I,onChange:r=>P(r.target.value),className:y("w-full mb-2 p-2 border rounded",(a==null?void 0:a.theme)==="dark"?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"),required:!0}),e.jsx("input",{type:"text",placeholder:"Tags (separadas por vírgula)",value:C,onChange:r=>$(r.target.value),className:y("w-full mb-2 p-2 border rounded",(a==null?void 0:a.theme)==="dark"?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500")}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(N,{onClick:()=>f(!1),variant:"outline",children:"Cancelar"}),e.jsx(N,{type:"submit",children:"Criar"})]})]}),w?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(r=>e.jsx(Z,{className:"h-32"},r))}):z.length>0?e.jsx("div",{className:y(A==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-4"),children:z.map(r=>e.jsxs(K,{className:"relative group hover:shadow-lg transition-shadow dark:bg-gray-800 dark:border-gray-700 bg-white border-gray-200",children:[e.jsx("button",{onClick:()=>Q("board",r.id,r.is_favorite),className:"absolute top-2 right-2 p-1 rounded-full dark:hover:bg-gray-700 hover:bg-gray-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:r.is_favorite?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:y("w-5 h-5",r.is_favorite?"text-yellow-400":"dark:text-gray-400 text-gray-500"),children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}),e.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>n(`/board/${r.id}`),children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 dark:text-white text-gray-900",children:r.title}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map(i=>e.jsx("span",{className:"px-2 py-1 rounded-full text-sm dark:bg-gray-700 dark:text-gray-300 bg-gray-100 text-gray-600",children:i},i))})]})]},r.id))}):e.jsx("div",{className:y("text-center py-8",(a==null?void 0:a.theme)==="dark"?"text-gray-400":"text-gray-500"),children:"Nenhum board encontrado"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold dark:text-white text-gray-900",children:"Páginas"}),e.jsxs(N,{onClick:()=>B(!0),className:"flex items-center space-x-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-plus w-5 h-5",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5v14"})]}),e.jsx("span",{children:"Nova Página"})]})]}),j&&e.jsxs("form",{onSubmit:oe,className:y("mb-4 p-4 border rounded-lg","dark:bg-gray-800 dark:border-gray-700 bg-white border-gray-300"),children:[e.jsx("input",{type:"text",placeholder:"Título da Página",value:F,onChange:r=>M(r.target.value),className:y("w-full mb-2 p-2 border rounded","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400","bg-white border-gray-300 text-gray-900 placeholder-gray-500"),required:!0}),e.jsx("input",{type:"text",placeholder:"Tags (separadas por vírgula)",value:O,onChange:r=>q(r.target.value),className:y("w-full mb-2 p-2 border rounded","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400","bg-white border-gray-300 text-gray-900 placeholder-gray-500")}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(N,{onClick:()=>B(!1),variant:"outline",className:"dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:"Cancelar"}),e.jsx(N,{type:"submit",className:"dark:bg-primary-600 dark:hover:bg-primary-700",children:"Criar"})]})]}),w?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(r=>e.jsx(Z,{className:"h-32"},r))}):H.length>0?e.jsx("div",{className:y(A==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-4"),children:H.map(r=>e.jsxs(K,{className:"relative group hover:shadow-lg transition-shadow dark:bg-gray-800 dark:border-gray-700 bg-white border-gray-200",children:[e.jsx("button",{onClick:()=>Q("page",r.id,r.is_favorite),className:"absolute top-2 right-2 p-1 rounded-full dark:hover:bg-gray-700 hover:bg-gray-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:r.is_favorite?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:y("w-5 h-5",r.is_favorite?"text-yellow-400":"dark:text-gray-400 text-gray-500"),children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}),e.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>n(`/page/${r.id}`),children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 dark:text-white text-gray-900",children:r.title}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map(i=>e.jsx("span",{className:"px-2 py-1 rounded-full text-sm dark:bg-gray-700 dark:text-gray-300 bg-gray-100 text-gray-600",children:i},i))})]})]},r.id))}):e.jsx("div",{className:y("text-center py-8",(a==null?void 0:a.theme)==="dark"?"text-gray-400":"text-gray-500"),children:"Nenhuma página encontrada"})]})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Bem-vindo ao Study Track"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Por favor, faça login para continuar."}),e.jsx("button",{onClick:()=>n("/login"),className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors",children:"Ir para Login"})]})};export{ke as default};
//# sourceMappingURL=Dashboard-juQxmLYE.js.map
