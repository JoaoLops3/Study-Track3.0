import{j as e}from"./ui-BN-0vsY4.js";import{r as n}from"./vendor-1oV-3_XS.js";import{c as I,u as X,s as d,X as $,U as G}from"./index-Kc8VGIUG.js";import{m as h}from"./proxy-DdY2QGUC.js";import{P as K}from"./plus-Sak_ZpnB.js";import{U as Q}from"./user-plus-DIsEF_4-.js";import{M as V}from"./mail-BBKAAakk.js";import{S as Y}from"./shield-1ux_TduV.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=I("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=I("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),re=n.createContext({});function te(){const a=n.useContext(re);if(!a)throw new Error("useToast must be used within a ToastProvider");return a}const he=()=>{const{user:a}=X(),[b,v]=n.useState([]),[z,y]=n.useState({}),[w,p]=n.useState({}),[L,j]=n.useState(!0),[P,x]=n.useState(!1),[U,g]=n.useState(!1),[m,N]=n.useState(null),[k,E]=n.useState(""),[C,S]=n.useState(""),[u,_]=n.useState(""),[f,T]=n.useState("member"),[ae,se]=n.useState(null),[q,ie]=n.useState(null),c=te();n.useEffect(()=>{a&&O()},[a]);const O=async()=>{try{j(!0);const{data:r,error:i}=await d.from("teams").select("*").or(`owner_id.eq.${a==null?void 0:a.id}`).order("created_at",{ascending:!1});if(i)throw i;v(r||[]);const s={},t={};for(const o of r||[]){const{data:l,error:M}=await d.from("team_members").select(`
            *,
            user_profiles (
              email
            )
          `).eq("team_id",o.id);if(M)throw M;s[o.id]=l||[];const{data:W,error:D}=await d.from("team_invites").select("*").eq("team_id",o.id).eq("status","pending");if(D)throw D;t[o.id]=W||[]}y(s),p(t)}catch(r){console.error("Error fetching teams:",r),c.error("Erro ao carregar equipes")}finally{j(!1)}},R=async r=>{if(r.preventDefault(),!!a)try{const{data:i,error:s}=await d.from("teams").insert([{name:k,description:C,owner_id:a.id}]).select().single();if(s)throw s;const{error:t}=await d.from("team_members").insert([{team_id:i.id,user_id:a.id,role:"owner"}]);if(t)throw t;v(o=>[i,...o]),E(""),S(""),x(!1),c.success("Equipe criada com sucesso!")}catch(i){console.error("Error creating team:",i),c.error("Erro ao criar equipe")}},A=async r=>{if(r.preventDefault(),!!m)try{const{data:i,error:s}=await d.from("teams").select("name").eq("id",m).single();if(s)throw s;const{data:t,error:o}=await d.from("team_invites").insert([{team_id:m,email:u,role:f,invited_by:a==null?void 0:a.id}]).select().single();if(o)throw o;await fetch("/api/send-invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:u,teamName:i.name,inviterEmail:(a==null?void 0:a.email)||"",inviteId:t.id})}),p(l=>({...l,[m]:[...l[m]||[],{id:t.id,team_id:m,email:u,role:f,status:"pending",invited_by:(a==null?void 0:a.id)??null,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),expires_at:new Date(Date.now()+7*24*60*60*1e3).toISOString()}]})),_(""),T("member"),g(!1),c.success("Convite enviado com sucesso!")}catch(i){console.error("Error inviting member:",i),c.error("Erro ao enviar convite")}},F=async(r,i)=>{try{const{error:s}=await d.from("team_members").delete().eq("id",i);if(s)throw s;y(t=>({...t,[r]:t[r].filter(o=>o.id!==i)})),c.success("Membro removido com sucesso!")}catch(s){console.error("Error removing member:",s),c.error("Erro ao remover membro")}},H=async(r,i)=>{try{const{error:s}=await d.from("team_invites").delete().eq("id",i);if(s)throw s;p(t=>({...t,[r]:t[r].filter(o=>o.id!==i)})),c.success("Convite cancelado com sucesso!")}catch(s){console.error("Error canceling invite:",s),c.error("Erro ao cancelar convite")}},B=async(r,i,s)=>{try{const{error:t}=await d.from("team_members").update({role:s}).eq("id",i);if(t)throw t;y(o=>({...o,[r]:o[r].map(l=>l.id===i?{...l,role:s}:l)})),c.success("Função atualizada com sucesso!")}catch(t){console.error("Error updating member role:",t),c.error("Erro ao atualizar função")}},J=r=>{switch(r){case"owner":return e.jsx(Z,{className:"h-4 w-4 text-yellow-500"});case"admin":return e.jsx(Y,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(G,{className:"h-4 w-4 text-gray-500"})}};return L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):q?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("p",{className:"text-red-600 font-medium mb-4",children:q}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Tentar novamente"})]}):e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Equipes"}),e.jsxs(h.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>x(!0),className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors",children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),"Nova Equipe"]})]}),b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("p",{className:"text-gray-600 font-medium mb-4",children:"Nenhuma equipe encontrada"}),e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Criar Equipe"})]}):e.jsx("div",{className:"space-y-6",children:b.map(r=>{var i,s;return e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.name}),r.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:r.description})]}),e.jsxs(h.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{N(r.id),g(!0)},className:"flex items-center px-3 py-1.5 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Convidar"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Membros"}),e.jsx("div",{className:"space-y-2",children:(i=z[r.id])==null?void 0:i.map(t=>{var o;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center",children:[J(t.role),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:(o=t.user_profiles)==null?void 0:o.email})]}),e.jsx("div",{className:"flex items-center space-x-2",children:t.role!=="owner"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.role,onChange:l=>B(r.id,t.id,l.target.value),className:"text-sm border-gray-300 dark:border-gray-600 rounded-md",disabled:t.user_id===(a==null?void 0:a.id),children:[e.jsx("option",{value:"member",children:"Membro"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx("button",{onClick:()=>F(r.id,t.id),className:"text-red-500 hover:text-red-700",disabled:t.user_id===(a==null?void 0:a.id),children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},t.id)})})]}),((s=w[r.id])==null?void 0:s.length)>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Convites Pendentes"}),e.jsx("div",{className:"space-y-2",children:w[r.id].map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:t.email})]}),e.jsx("button",{onClick:()=>H(r.id,t.id),className:"text-red-500 hover:text-red-700",children:e.jsx($,{className:"h-4 w-4"})})]},t.id))})]})]})]},r.id)})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:"Criar Nova Equipe"}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nome"}),e.jsx("input",{type:"text",value:k,onChange:r=>E(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"Digite o nome da equipe",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descrição"}),e.jsx("textarea",{value:C,onChange:r=>S(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"Digite a descrição da equipe",rows:3})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700",children:"Criar"})]})]})]})}),U&&m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:"Convidar Membro"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("input",{type:"email",value:u,onChange:r=>_(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"Digite o email do membro",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Função"}),e.jsxs("select",{value:f,onChange:r=>T(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"member",children:"Membro"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),N(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700",children:"Enviar Convite"})]})]})]})})]})};export{he as default};
